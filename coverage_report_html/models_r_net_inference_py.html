


<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    
    <meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
    <title>Coverage for models/r_net/inference.py: 97%</title>
    <link rel="stylesheet" href="style.css" type="text/css">
    
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="jquery.hotkeys.js"></script>
    <script type="text/javascript" src="jquery.isonscreen.js"></script>
    <script type="text/javascript" src="coverage_html.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(coverage.pyfile_ready);
    </script>
</head>
<body class="pyfile">

<div id="header">
    <div class="content">
        <h1>Coverage for <b>models/r_net/inference.py</b> :
            <span class="pc_cov">97%</span>
        </h1>

        <img id="keyboard_icon" src="keybd_closed.png" alt="Show keyboard shortcuts" />

        <h2 class="stats">
            183 statements &nbsp;
            <span class="run hide_run shortkey_r button_toggle_run">178 run</span>
            <span class="mis shortkey_m button_toggle_mis">5 missing</span>
            <span class="exc shortkey_x button_toggle_exc">0 excluded</span>

            
        </h2>
    </div>
</div>

<div class="help_panel">
    <img id="panel_icon" src="keybd_open.png" alt="Hide keyboard shortcuts" />
    <p class="legend">Hot-keys on this page</p>
    <div>
    <p class="keyhelp">
        <span class="key">r</span>
        <span class="key">m</span>
        <span class="key">x</span>
        <span class="key">p</span> &nbsp; toggle line displays
    </p>
    <p class="keyhelp">
        <span class="key">j</span>
        <span class="key">k</span> &nbsp; next/prev highlighted chunk
    </p>
    <p class="keyhelp">
        <span class="key">0</span> &nbsp; (zero) top of page
    </p>
    <p class="keyhelp">
        <span class="key">1</span> &nbsp; (one) first highlighted chunk
    </p>
    </div>
</div>

<div id="source">
    <table>
        <tr>
            <td class="linenos">
<p id="n1" class="stm run hide_run"><a href="#n1">1</a></p>
<p id="n2" class="stm run hide_run"><a href="#n2">2</a></p>
<p id="n3" class="stm run hide_run"><a href="#n3">3</a></p>
<p id="n4" class="stm run hide_run"><a href="#n4">4</a></p>
<p id="n5" class="pln"><a href="#n5">5</a></p>
<p id="n6" class="stm run hide_run"><a href="#n6">6</a></p>
<p id="n7" class="stm run hide_run"><a href="#n7">7</a></p>
<p id="n8" class="pln"><a href="#n8">8</a></p>
<p id="n9" class="stm run hide_run"><a href="#n9">9</a></p>
<p id="n10" class="stm run hide_run"><a href="#n10">10</a></p>
<p id="n11" class="stm run hide_run"><a href="#n11">11</a></p>
<p id="n12" class="stm run hide_run"><a href="#n12">12</a></p>
<p id="n13" class="pln"><a href="#n13">13</a></p>
<p id="n14" class="stm run hide_run"><a href="#n14">14</a></p>
<p id="n15" class="stm run hide_run"><a href="#n15">15</a></p>
<p id="n16" class="pln"><a href="#n16">16</a></p>
<p id="n17" class="stm run hide_run"><a href="#n17">17</a></p>
<p id="n18" class="pln"><a href="#n18">18</a></p>
<p id="n19" class="pln"><a href="#n19">19</a></p>
<p id="n20" class="stm run hide_run"><a href="#n20">20</a></p>
<p id="n21" class="stm run hide_run"><a href="#n21">21</a></p>
<p id="n22" class="stm run hide_run"><a href="#n22">22</a></p>
<p id="n23" class="stm run hide_run"><a href="#n23">23</a></p>
<p id="n24" class="stm run hide_run"><a href="#n24">24</a></p>
<p id="n25" class="pln"><a href="#n25">25</a></p>
<p id="n26" class="pln"><a href="#n26">26</a></p>
<p id="n27" class="stm run hide_run"><a href="#n27">27</a></p>
<p id="n28" class="stm run hide_run"><a href="#n28">28</a></p>
<p id="n29" class="stm run hide_run"><a href="#n29">29</a></p>
<p id="n30" class="stm run hide_run"><a href="#n30">30</a></p>
<p id="n31" class="stm run hide_run"><a href="#n31">31</a></p>
<p id="n32" class="stm run hide_run"><a href="#n32">32</a></p>
<p id="n33" class="pln"><a href="#n33">33</a></p>
<p id="n34" class="pln"><a href="#n34">34</a></p>
<p id="n35" class="stm run hide_run"><a href="#n35">35</a></p>
<p id="n36" class="pln"><a href="#n36">36</a></p>
<p id="n37" class="pln"><a href="#n37">37</a></p>
<p id="n38" class="stm run hide_run"><a href="#n38">38</a></p>
<p id="n39" class="pln"><a href="#n39">39</a></p>
<p id="n40" class="stm run hide_run"><a href="#n40">40</a></p>
<p id="n41" class="stm run hide_run"><a href="#n41">41</a></p>
<p id="n42" class="stm run hide_run"><a href="#n42">42</a></p>
<p id="n43" class="stm run hide_run"><a href="#n43">43</a></p>
<p id="n44" class="stm run hide_run"><a href="#n44">44</a></p>
<p id="n45" class="stm run hide_run"><a href="#n45">45</a></p>
<p id="n46" class="pln"><a href="#n46">46</a></p>
<p id="n47" class="stm run hide_run"><a href="#n47">47</a></p>
<p id="n48" class="pln"><a href="#n48">48</a></p>
<p id="n49" class="stm run hide_run"><a href="#n49">49</a></p>
<p id="n50" class="pln"><a href="#n50">50</a></p>
<p id="n51" class="stm run hide_run"><a href="#n51">51</a></p>
<p id="n52" class="stm run hide_run"><a href="#n52">52</a></p>
<p id="n53" class="stm run hide_run"><a href="#n53">53</a></p>
<p id="n54" class="stm run hide_run"><a href="#n54">54</a></p>
<p id="n55" class="pln"><a href="#n55">55</a></p>
<p id="n56" class="stm run hide_run"><a href="#n56">56</a></p>
<p id="n57" class="stm run hide_run"><a href="#n57">57</a></p>
<p id="n58" class="pln"><a href="#n58">58</a></p>
<p id="n59" class="stm run hide_run"><a href="#n59">59</a></p>
<p id="n60" class="stm run hide_run"><a href="#n60">60</a></p>
<p id="n61" class="pln"><a href="#n61">61</a></p>
<p id="n62" class="stm run hide_run"><a href="#n62">62</a></p>
<p id="n63" class="pln"><a href="#n63">63</a></p>
<p id="n64" class="stm run hide_run"><a href="#n64">64</a></p>
<p id="n65" class="stm run hide_run"><a href="#n65">65</a></p>
<p id="n66" class="stm run hide_run"><a href="#n66">66</a></p>
<p id="n67" class="pln"><a href="#n67">67</a></p>
<p id="n68" class="stm run hide_run"><a href="#n68">68</a></p>
<p id="n69" class="stm run hide_run"><a href="#n69">69</a></p>
<p id="n70" class="stm run hide_run"><a href="#n70">70</a></p>
<p id="n71" class="stm run hide_run"><a href="#n71">71</a></p>
<p id="n72" class="stm run hide_run"><a href="#n72">72</a></p>
<p id="n73" class="stm run hide_run"><a href="#n73">73</a></p>
<p id="n74" class="stm run hide_run"><a href="#n74">74</a></p>
<p id="n75" class="pln"><a href="#n75">75</a></p>
<p id="n76" class="stm run hide_run"><a href="#n76">76</a></p>
<p id="n77" class="stm run hide_run"><a href="#n77">77</a></p>
<p id="n78" class="pln"><a href="#n78">78</a></p>
<p id="n79" class="stm run hide_run"><a href="#n79">79</a></p>
<p id="n80" class="stm run hide_run"><a href="#n80">80</a></p>
<p id="n81" class="stm run hide_run"><a href="#n81">81</a></p>
<p id="n82" class="pln"><a href="#n82">82</a></p>
<p id="n83" class="stm run hide_run"><a href="#n83">83</a></p>
<p id="n84" class="stm run hide_run"><a href="#n84">84</a></p>
<p id="n85" class="stm run hide_run"><a href="#n85">85</a></p>
<p id="n86" class="pln"><a href="#n86">86</a></p>
<p id="n87" class="stm run hide_run"><a href="#n87">87</a></p>
<p id="n88" class="stm run hide_run"><a href="#n88">88</a></p>
<p id="n89" class="pln"><a href="#n89">89</a></p>
<p id="n90" class="stm run hide_run"><a href="#n90">90</a></p>
<p id="n91" class="stm run hide_run"><a href="#n91">91</a></p>
<p id="n92" class="stm run hide_run"><a href="#n92">92</a></p>
<p id="n93" class="stm run hide_run"><a href="#n93">93</a></p>
<p id="n94" class="pln"><a href="#n94">94</a></p>
<p id="n95" class="stm run hide_run"><a href="#n95">95</a></p>
<p id="n96" class="stm run hide_run"><a href="#n96">96</a></p>
<p id="n97" class="stm run hide_run"><a href="#n97">97</a></p>
<p id="n98" class="stm run hide_run"><a href="#n98">98</a></p>
<p id="n99" class="pln"><a href="#n99">99</a></p>
<p id="n100" class="stm run hide_run"><a href="#n100">100</a></p>
<p id="n101" class="stm run hide_run"><a href="#n101">101</a></p>
<p id="n102" class="stm run hide_run"><a href="#n102">102</a></p>
<p id="n103" class="stm run hide_run"><a href="#n103">103</a></p>
<p id="n104" class="pln"><a href="#n104">104</a></p>
<p id="n105" class="stm run hide_run"><a href="#n105">105</a></p>
<p id="n106" class="stm run hide_run"><a href="#n106">106</a></p>
<p id="n107" class="stm run hide_run"><a href="#n107">107</a></p>
<p id="n108" class="stm run hide_run"><a href="#n108">108</a></p>
<p id="n109" class="pln"><a href="#n109">109</a></p>
<p id="n110" class="stm run hide_run"><a href="#n110">110</a></p>
<p id="n111" class="stm run hide_run"><a href="#n111">111</a></p>
<p id="n112" class="pln"><a href="#n112">112</a></p>
<p id="n113" class="stm run hide_run"><a href="#n113">113</a></p>
<p id="n114" class="pln"><a href="#n114">114</a></p>
<p id="n115" class="stm run hide_run"><a href="#n115">115</a></p>
<p id="n116" class="stm run hide_run"><a href="#n116">116</a></p>
<p id="n117" class="pln"><a href="#n117">117</a></p>
<p id="n118" class="pln"><a href="#n118">118</a></p>
<p id="n119" class="stm run hide_run"><a href="#n119">119</a></p>
<p id="n120" class="pln"><a href="#n120">120</a></p>
<p id="n121" class="stm run hide_run"><a href="#n121">121</a></p>
<p id="n122" class="stm run hide_run"><a href="#n122">122</a></p>
<p id="n123" class="stm run hide_run"><a href="#n123">123</a></p>
<p id="n124" class="stm run hide_run"><a href="#n124">124</a></p>
<p id="n125" class="stm run hide_run"><a href="#n125">125</a></p>
<p id="n126" class="stm run hide_run"><a href="#n126">126</a></p>
<p id="n127" class="stm run hide_run"><a href="#n127">127</a></p>
<p id="n128" class="stm run hide_run"><a href="#n128">128</a></p>
<p id="n129" class="stm run hide_run"><a href="#n129">129</a></p>
<p id="n130" class="stm run hide_run"><a href="#n130">130</a></p>
<p id="n131" class="stm run hide_run"><a href="#n131">131</a></p>
<p id="n132" class="stm run hide_run"><a href="#n132">132</a></p>
<p id="n133" class="stm run hide_run"><a href="#n133">133</a></p>
<p id="n134" class="stm run hide_run"><a href="#n134">134</a></p>
<p id="n135" class="stm run hide_run"><a href="#n135">135</a></p>
<p id="n136" class="pln"><a href="#n136">136</a></p>
<p id="n137" class="stm run hide_run"><a href="#n137">137</a></p>
<p id="n138" class="stm run hide_run"><a href="#n138">138</a></p>
<p id="n139" class="stm run hide_run"><a href="#n139">139</a></p>
<p id="n140" class="stm run hide_run"><a href="#n140">140</a></p>
<p id="n141" class="stm run hide_run"><a href="#n141">141</a></p>
<p id="n142" class="pln"><a href="#n142">142</a></p>
<p id="n143" class="pln"><a href="#n143">143</a></p>
<p id="n144" class="stm run hide_run"><a href="#n144">144</a></p>
<p id="n145" class="stm run hide_run"><a href="#n145">145</a></p>
<p id="n146" class="stm run hide_run"><a href="#n146">146</a></p>
<p id="n147" class="pln"><a href="#n147">147</a></p>
<p id="n148" class="stm run hide_run"><a href="#n148">148</a></p>
<p id="n149" class="stm run hide_run"><a href="#n149">149</a></p>
<p id="n150" class="stm run hide_run"><a href="#n150">150</a></p>
<p id="n151" class="stm run hide_run"><a href="#n151">151</a></p>
<p id="n152" class="stm run hide_run"><a href="#n152">152</a></p>
<p id="n153" class="stm run hide_run"><a href="#n153">153</a></p>
<p id="n154" class="stm run hide_run"><a href="#n154">154</a></p>
<p id="n155" class="stm run hide_run"><a href="#n155">155</a></p>
<p id="n156" class="pln"><a href="#n156">156</a></p>
<p id="n157" class="stm run hide_run"><a href="#n157">157</a></p>
<p id="n158" class="stm run hide_run"><a href="#n158">158</a></p>
<p id="n159" class="stm run hide_run"><a href="#n159">159</a></p>
<p id="n160" class="stm run hide_run"><a href="#n160">160</a></p>
<p id="n161" class="pln"><a href="#n161">161</a></p>
<p id="n162" class="stm run hide_run"><a href="#n162">162</a></p>
<p id="n163" class="stm run hide_run"><a href="#n163">163</a></p>
<p id="n164" class="stm run hide_run"><a href="#n164">164</a></p>
<p id="n165" class="stm run hide_run"><a href="#n165">165</a></p>
<p id="n166" class="stm run hide_run"><a href="#n166">166</a></p>
<p id="n167" class="pln"><a href="#n167">167</a></p>
<p id="n168" class="stm run hide_run"><a href="#n168">168</a></p>
<p id="n169" class="stm run hide_run"><a href="#n169">169</a></p>
<p id="n170" class="stm run hide_run"><a href="#n170">170</a></p>
<p id="n171" class="stm mis"><a href="#n171">171</a></p>
<p id="n172" class="pln"><a href="#n172">172</a></p>
<p id="n173" class="stm run hide_run"><a href="#n173">173</a></p>
<p id="n174" class="stm run hide_run"><a href="#n174">174</a></p>
<p id="n175" class="pln"><a href="#n175">175</a></p>
<p id="n176" class="stm run hide_run"><a href="#n176">176</a></p>
<p id="n177" class="stm run hide_run"><a href="#n177">177</a></p>
<p id="n178" class="pln"><a href="#n178">178</a></p>
<p id="n179" class="stm run hide_run"><a href="#n179">179</a></p>
<p id="n180" class="stm run hide_run"><a href="#n180">180</a></p>
<p id="n181" class="stm run hide_run"><a href="#n181">181</a></p>
<p id="n182" class="stm run hide_run"><a href="#n182">182</a></p>
<p id="n183" class="stm run hide_run"><a href="#n183">183</a></p>
<p id="n184" class="pln"><a href="#n184">184</a></p>
<p id="n185" class="stm run hide_run"><a href="#n185">185</a></p>
<p id="n186" class="stm run hide_run"><a href="#n186">186</a></p>
<p id="n187" class="stm run hide_run"><a href="#n187">187</a></p>
<p id="n188" class="stm mis"><a href="#n188">188</a></p>
<p id="n189" class="stm run hide_run"><a href="#n189">189</a></p>
<p id="n190" class="stm run hide_run"><a href="#n190">190</a></p>
<p id="n191" class="pln"><a href="#n191">191</a></p>
<p id="n192" class="pln"><a href="#n192">192</a></p>
<p id="n193" class="pln"><a href="#n193">193</a></p>
<p id="n194" class="stm run hide_run"><a href="#n194">194</a></p>
<p id="n195" class="stm run hide_run"><a href="#n195">195</a></p>
<p id="n196" class="pln"><a href="#n196">196</a></p>
<p id="n197" class="stm run hide_run"><a href="#n197">197</a></p>
<p id="n198" class="stm run hide_run"><a href="#n198">198</a></p>
<p id="n199" class="stm run hide_run"><a href="#n199">199</a></p>
<p id="n200" class="stm run hide_run"><a href="#n200">200</a></p>
<p id="n201" class="pln"><a href="#n201">201</a></p>
<p id="n202" class="pln"><a href="#n202">202</a></p>
<p id="n203" class="stm run hide_run"><a href="#n203">203</a></p>
<p id="n204" class="stm run hide_run"><a href="#n204">204</a></p>
<p id="n205" class="stm run hide_run"><a href="#n205">205</a></p>
<p id="n206" class="stm run hide_run"><a href="#n206">206</a></p>
<p id="n207" class="stm run hide_run"><a href="#n207">207</a></p>
<p id="n208" class="stm run hide_run"><a href="#n208">208</a></p>
<p id="n209" class="stm run hide_run"><a href="#n209">209</a></p>
<p id="n210" class="stm run hide_run"><a href="#n210">210</a></p>
<p id="n211" class="stm run hide_run"><a href="#n211">211</a></p>
<p id="n212" class="stm run hide_run"><a href="#n212">212</a></p>
<p id="n213" class="stm mis"><a href="#n213">213</a></p>
<p id="n214" class="stm run hide_run"><a href="#n214">214</a></p>
<p id="n215" class="stm run hide_run"><a href="#n215">215</a></p>
<p id="n216" class="stm run hide_run"><a href="#n216">216</a></p>
<p id="n217" class="stm run hide_run"><a href="#n217">217</a></p>
<p id="n218" class="stm run hide_run"><a href="#n218">218</a></p>
<p id="n219" class="pln"><a href="#n219">219</a></p>
<p id="n220" class="pln"><a href="#n220">220</a></p>
<p id="n221" class="stm run hide_run"><a href="#n221">221</a></p>
<p id="n222" class="stm run hide_run"><a href="#n222">222</a></p>
<p id="n223" class="stm run hide_run"><a href="#n223">223</a></p>
<p id="n224" class="stm run hide_run"><a href="#n224">224</a></p>
<p id="n225" class="stm run hide_run"><a href="#n225">225</a></p>
<p id="n226" class="stm run hide_run"><a href="#n226">226</a></p>
<p id="n227" class="stm run hide_run"><a href="#n227">227</a></p>
<p id="n228" class="stm run hide_run"><a href="#n228">228</a></p>
<p id="n229" class="stm mis"><a href="#n229">229</a></p>
<p id="n230" class="stm run hide_run"><a href="#n230">230</a></p>
<p id="n231" class="pln"><a href="#n231">231</a></p>
<p id="n232" class="stm run hide_run"><a href="#n232">232</a></p>
<p id="n233" class="stm run hide_run"><a href="#n233">233</a></p>
<p id="n234" class="stm run hide_run"><a href="#n234">234</a></p>
<p id="n235" class="pln"><a href="#n235">235</a></p>
<p id="n236" class="stm mis"><a href="#n236">236</a></p>
<p id="n237" class="stm run hide_run"><a href="#n237">237</a></p>
<p id="n238" class="pln"><a href="#n238">238</a></p>
<p id="n239" class="pln"><a href="#n239">239</a></p>
<p id="n240" class="stm run hide_run"><a href="#n240">240</a></p>
<p id="n241" class="stm run hide_run"><a href="#n241">241</a></p>
<p id="n242" class="pln"><a href="#n242">242</a></p>

            </td>
            <td class="text">
<p id="t1" class="stm run hide_run"><span class="key">import</span> <span class="nam">os</span><span class="strut">&nbsp;</span></p>
<p id="t2" class="stm run hide_run"><span class="key">import</span> <span class="nam">sys</span><span class="strut">&nbsp;</span></p>
<p id="t3" class="stm run hide_run"><span class="key">import</span> <span class="nam">ujson</span> <span class="key">as</span> <span class="nam">json</span><span class="strut">&nbsp;</span></p>
<p id="t4" class="stm run hide_run"><span class="key">from</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span> <span class="key">import</span> <span class="nam">dirname</span><span class="op">,</span> <span class="nam">abspath</span><span class="strut">&nbsp;</span></p>
<p id="t5" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t6" class="stm run hide_run"><span class="key">import</span> <span class="nam">numpy</span> <span class="key">as</span> <span class="nam">np</span><span class="strut">&nbsp;</span></p>
<p id="t7" class="stm run hide_run"><span class="key">import</span> <span class="nam">tensorflow</span> <span class="key">as</span> <span class="nam">tf</span><span class="strut">&nbsp;</span></p>
<p id="t8" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t9" class="stm run hide_run"><span class="nam">d</span> <span class="op">=</span> <span class="nam">dirname</span><span class="op">(</span><span class="nam">dirname</span><span class="op">(</span><span class="nam">dirname</span><span class="op">(</span><span class="nam">abspath</span><span class="op">(</span><span class="nam">__file__</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t10" class="stm run hide_run"><span class="nam">sys</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">d</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t11" class="stm run hide_run"><span class="key">from</span> <span class="nam">models</span><span class="op">.</span><span class="nam">r_net</span><span class="op">.</span><span class="nam">func</span> <span class="key">import</span> <span class="nam">cudnn_gru</span><span class="op">,</span> <span class="nam">native_gru</span><span class="op">,</span> <span class="nam">dot_attention</span><span class="op">,</span> <span class="nam">summ</span><span class="op">,</span> <span class="nam">ptr_net</span><span class="strut">&nbsp;</span></p>
<p id="t12" class="stm run hide_run"><span class="key">from</span> <span class="nam">models</span><span class="op">.</span><span class="nam">r_net</span><span class="op">.</span><span class="nam">prepro</span> <span class="key">import</span> <span class="nam">word_tokenize</span><span class="op">,</span> <span class="nam">convert_idx</span><span class="strut">&nbsp;</span></p>
<p id="t13" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t14" class="stm run hide_run"><span class="nam">parent_dir</span> <span class="op">=</span> <span class="nam">dirname</span><span class="op">(</span><span class="nam">abspath</span><span class="op">(</span><span class="nam">__file__</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t15" class="stm run hide_run"><span class="nam">home_dir</span> <span class="op">=</span> <span class="nam">dirname</span><span class="op">(</span><span class="nam">dirname</span><span class="op">(</span><span class="nam">dirname</span><span class="op">(</span><span class="nam">abspath</span><span class="op">(</span><span class="nam">__file__</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t16" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t17" class="stm run hide_run"><span class="nam">os</span><span class="op">.</span><span class="nam">environ</span><span class="op">[</span><span class="str">'TF_CPP_MIN_LOG_LEVEL'</span><span class="op">]</span> <span class="op">=</span> <span class="str">'3'</span><span class="strut">&nbsp;</span></p>
<p id="t18" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t19" class="pln"><span class="com"># Must be consistant with training</span><span class="strut">&nbsp;</span></p>
<p id="t20" class="stm run hide_run"><span class="nam">char_limit</span> <span class="op">=</span> <span class="num">16</span><span class="strut">&nbsp;</span></p>
<p id="t21" class="stm run hide_run"><span class="nam">hidden</span> <span class="op">=</span> <span class="num">75</span><span class="strut">&nbsp;</span></p>
<p id="t22" class="stm run hide_run"><span class="nam">char_dim</span> <span class="op">=</span> <span class="num">8</span><span class="strut">&nbsp;</span></p>
<p id="t23" class="stm run hide_run"><span class="nam">char_hidden</span> <span class="op">=</span> <span class="num">100</span><span class="strut">&nbsp;</span></p>
<p id="t24" class="stm run hide_run"><span class="nam">use_cudnn</span> <span class="op">=</span> <span class="key">False</span><span class="strut">&nbsp;</span></p>
<p id="t25" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t26" class="pln"><span class="com"># File path</span><span class="strut">&nbsp;</span></p>
<p id="t27" class="stm run hide_run"><span class="nam">target_dir</span> <span class="op">=</span> <span class="str">'{}/data'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">parent_dir</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t28" class="stm run hide_run"><span class="nam">save_dir</span> <span class="op">=</span> <span class="str">'{}/log/model'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">parent_dir</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t29" class="stm run hide_run"><span class="nam">word_emb_file</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">target_dir</span><span class="op">,</span> <span class="str">'word_emb.json'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t30" class="stm run hide_run"><span class="nam">char_emb_file</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">target_dir</span><span class="op">,</span> <span class="str">'char_emb.json'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t31" class="stm run hide_run"><span class="nam">word2idx_file</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">target_dir</span><span class="op">,</span> <span class="str">'word2idx.json'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t32" class="stm run hide_run"><span class="nam">char2idx_file</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">target_dir</span><span class="op">,</span> <span class="str">'char2idx.json'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t33" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t34" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t35" class="stm run hide_run"><span class="key">class</span> <span class="nam">InfModel</span><span class="op">(</span><span class="nam">object</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t36" class="pln">    <span class="com"># Used to zero elements in the probability matrix that correspond to answer</span><span class="strut">&nbsp;</span></p>
<p id="t37" class="pln">    <span class="com"># spans that are longer than the number of tokens specified here.</span><span class="strut">&nbsp;</span></p>
<p id="t38" class="stm run hide_run">    <span class="nam">max_answer_tokens</span> <span class="op">=</span> <span class="num">15</span><span class="strut">&nbsp;</span></p>
<p id="t39" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t40" class="stm run hide_run">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">word_mat</span><span class="op">,</span> <span class="nam">char_mat</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t41" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">c</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">placeholder</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">int32</span><span class="op">,</span> <span class="op">[</span><span class="num">1</span><span class="op">,</span> <span class="key">None</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t42" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">q</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">placeholder</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">int32</span><span class="op">,</span> <span class="op">[</span><span class="num">1</span><span class="op">,</span> <span class="key">None</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t43" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">ch</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">placeholder</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">int32</span><span class="op">,</span> <span class="op">[</span><span class="num">1</span><span class="op">,</span> <span class="key">None</span><span class="op">,</span> <span class="nam">char_limit</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t44" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">qh</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">placeholder</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">int32</span><span class="op">,</span> <span class="op">[</span><span class="num">1</span><span class="op">,</span> <span class="key">None</span><span class="op">,</span> <span class="nam">char_limit</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t45" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">tokens_in_context</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">placeholder</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">int64</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t46" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t47" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">word_mat</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">get_variable</span><span class="op">(</span><span class="str">'word_mat'</span><span class="op">,</span> <span class="nam">initializer</span><span class="op">=</span><span class="nam">tf</span><span class="op">.</span><span class="nam">constant</span><span class="op">(</span><span class="nam">word_mat</span><span class="op">,</span> <span class="nam">dtype</span><span class="op">=</span><span class="nam">tf</span><span class="op">.</span><span class="nam">float32</span><span class="op">)</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t48" class="pln">                                        <span class="nam">trainable</span><span class="op">=</span><span class="key">False</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t49" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">char_mat</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">get_variable</span><span class="op">(</span><span class="str">'char_mat'</span><span class="op">,</span> <span class="nam">initializer</span><span class="op">=</span><span class="nam">tf</span><span class="op">.</span><span class="nam">constant</span><span class="op">(</span><span class="nam">char_mat</span><span class="op">,</span> <span class="nam">dtype</span><span class="op">=</span><span class="nam">tf</span><span class="op">.</span><span class="nam">float32</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t50" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t51" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">c_mask</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">cast</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">c</span><span class="op">,</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">bool</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t52" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">q_mask</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">cast</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">q</span><span class="op">,</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">bool</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t53" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">c_len</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">reduce_sum</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">cast</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">c_mask</span><span class="op">,</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">int32</span><span class="op">)</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t54" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">q_len</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">reduce_sum</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">cast</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">q_mask</span><span class="op">,</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">int32</span><span class="op">)</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t55" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t56" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">c_maxlen</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">reduce_max</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">c_len</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t57" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">q_maxlen</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">reduce_max</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">q_len</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t58" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t59" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">ch_len</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">reshape</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">reduce_sum</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">cast</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">cast</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">ch</span><span class="op">,</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">bool</span><span class="op">)</span><span class="op">,</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">int32</span><span class="op">)</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">2</span><span class="op">)</span><span class="op">,</span> <span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t60" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">qh_len</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">reshape</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">reduce_sum</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">cast</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">cast</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">qh</span><span class="op">,</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">bool</span><span class="op">)</span><span class="op">,</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">int32</span><span class="op">)</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">2</span><span class="op">)</span><span class="op">,</span> <span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t61" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t62" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">ready</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t63" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t64" class="stm run hide_run">    <span class="key">def</span> <span class="nam">ready</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t65" class="stm run hide_run">        <span class="nam">N</span><span class="op">,</span> <span class="nam">PL</span><span class="op">,</span> <span class="nam">QL</span><span class="op">,</span> <span class="nam">CL</span><span class="op">,</span> <span class="nam">d</span><span class="op">,</span> <span class="nam">dc</span><span class="op">,</span> <span class="nam">dg</span> <span class="op">=</span> <span class="num">1</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">c_maxlen</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">q_maxlen</span><span class="op">,</span> <span class="nam">char_limit</span><span class="op">,</span> <span class="nam">hidden</span><span class="op">,</span> <span class="nam">char_dim</span><span class="op">,</span> <span class="nam">char_hidden</span><span class="strut">&nbsp;</span></p>
<p id="t66" class="stm run hide_run">        <span class="nam">gru</span> <span class="op">=</span> <span class="nam">cudnn_gru</span> <span class="key">if</span> <span class="nam">use_cudnn</span> <span class="key">else</span> <span class="nam">native_gru</span><span class="strut">&nbsp;</span></p>
<p id="t67" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t68" class="stm run hide_run">        <span class="key">with</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">variable_scope</span><span class="op">(</span><span class="str">'emb'</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t69" class="stm run hide_run">            <span class="key">with</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">variable_scope</span><span class="op">(</span><span class="str">'char'</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t70" class="stm run hide_run">                <span class="nam">ch_emb</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">reshape</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">nn</span><span class="op">.</span><span class="nam">embedding_lookup</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">char_mat</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">ch</span><span class="op">)</span><span class="op">,</span> <span class="op">[</span><span class="nam">N</span> <span class="op">*</span> <span class="nam">PL</span><span class="op">,</span> <span class="nam">CL</span><span class="op">,</span> <span class="nam">dc</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t71" class="stm run hide_run">                <span class="nam">qh_emb</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">reshape</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">nn</span><span class="op">.</span><span class="nam">embedding_lookup</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">char_mat</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">qh</span><span class="op">)</span><span class="op">,</span> <span class="op">[</span><span class="nam">N</span> <span class="op">*</span> <span class="nam">QL</span><span class="op">,</span> <span class="nam">CL</span><span class="op">,</span> <span class="nam">dc</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t72" class="stm run hide_run">                <span class="nam">cell_fw</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">contrib</span><span class="op">.</span><span class="nam">rnn</span><span class="op">.</span><span class="nam">GRUCell</span><span class="op">(</span><span class="nam">dg</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t73" class="stm run hide_run">                <span class="nam">cell_bw</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">contrib</span><span class="op">.</span><span class="nam">rnn</span><span class="op">.</span><span class="nam">GRUCell</span><span class="op">(</span><span class="nam">dg</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t74" class="stm run hide_run">                <span class="nam">_</span><span class="op">,</span> <span class="op">(</span><span class="nam">state_fw</span><span class="op">,</span> <span class="nam">state_bw</span><span class="op">)</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">nn</span><span class="op">.</span><span class="nam">bidirectional_dynamic_rnn</span><span class="op">(</span><span class="nam">cell_fw</span><span class="op">,</span> <span class="nam">cell_bw</span><span class="op">,</span> <span class="nam">ch_emb</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">ch_len</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t75" class="pln">                    <span class="nam">dtype</span><span class="op">=</span><span class="nam">tf</span><span class="op">.</span><span class="nam">float32</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t76" class="stm run hide_run">                <span class="nam">ch_emb</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">concat</span><span class="op">(</span><span class="op">[</span><span class="nam">state_fw</span><span class="op">,</span> <span class="nam">state_bw</span><span class="op">]</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t77" class="stm run hide_run">                <span class="nam">_</span><span class="op">,</span> <span class="op">(</span><span class="nam">state_fw</span><span class="op">,</span> <span class="nam">state_bw</span><span class="op">)</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">nn</span><span class="op">.</span><span class="nam">bidirectional_dynamic_rnn</span><span class="op">(</span><span class="nam">cell_fw</span><span class="op">,</span> <span class="nam">cell_bw</span><span class="op">,</span> <span class="nam">qh_emb</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">qh_len</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t78" class="pln">                    <span class="nam">dtype</span><span class="op">=</span><span class="nam">tf</span><span class="op">.</span><span class="nam">float32</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t79" class="stm run hide_run">                <span class="nam">qh_emb</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">concat</span><span class="op">(</span><span class="op">[</span><span class="nam">state_fw</span><span class="op">,</span> <span class="nam">state_bw</span><span class="op">]</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t80" class="stm run hide_run">                <span class="nam">qh_emb</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">reshape</span><span class="op">(</span><span class="nam">qh_emb</span><span class="op">,</span> <span class="op">[</span><span class="nam">N</span><span class="op">,</span> <span class="nam">QL</span><span class="op">,</span> <span class="num">2</span> <span class="op">*</span> <span class="nam">dg</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t81" class="stm run hide_run">                <span class="nam">ch_emb</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">reshape</span><span class="op">(</span><span class="nam">ch_emb</span><span class="op">,</span> <span class="op">[</span><span class="nam">N</span><span class="op">,</span> <span class="nam">PL</span><span class="op">,</span> <span class="num">2</span> <span class="op">*</span> <span class="nam">dg</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t82" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t83" class="stm run hide_run">            <span class="key">with</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">name_scope</span><span class="op">(</span><span class="str">'word'</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t84" class="stm run hide_run">                <span class="nam">c_emb</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">nn</span><span class="op">.</span><span class="nam">embedding_lookup</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">word_mat</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">c</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t85" class="stm run hide_run">                <span class="nam">q_emb</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">nn</span><span class="op">.</span><span class="nam">embedding_lookup</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">word_mat</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">q</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t86" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t87" class="stm run hide_run">            <span class="nam">c_emb</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">concat</span><span class="op">(</span><span class="op">[</span><span class="nam">c_emb</span><span class="op">,</span> <span class="nam">ch_emb</span><span class="op">]</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">2</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t88" class="stm run hide_run">            <span class="nam">q_emb</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">concat</span><span class="op">(</span><span class="op">[</span><span class="nam">q_emb</span><span class="op">,</span> <span class="nam">qh_emb</span><span class="op">]</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">2</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t89" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t90" class="stm run hide_run">        <span class="key">with</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">variable_scope</span><span class="op">(</span><span class="str">'encoding'</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t91" class="stm run hide_run">            <span class="nam">rnn</span> <span class="op">=</span> <span class="nam">gru</span><span class="op">(</span><span class="nam">num_layers</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">num_units</span><span class="op">=</span><span class="nam">d</span><span class="op">,</span> <span class="nam">batch_size</span><span class="op">=</span><span class="nam">N</span><span class="op">,</span> <span class="nam">input_size</span><span class="op">=</span><span class="nam">c_emb</span><span class="op">.</span><span class="nam">get_shape</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">as_list</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t92" class="stm run hide_run">            <span class="nam">c</span> <span class="op">=</span> <span class="nam">rnn</span><span class="op">(</span><span class="nam">c_emb</span><span class="op">,</span> <span class="nam">seq_len</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">c_len</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t93" class="stm run hide_run">            <span class="nam">q</span> <span class="op">=</span> <span class="nam">rnn</span><span class="op">(</span><span class="nam">q_emb</span><span class="op">,</span> <span class="nam">seq_len</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">q_len</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t94" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t95" class="stm run hide_run">        <span class="key">with</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">variable_scope</span><span class="op">(</span><span class="str">'attention'</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t96" class="stm run hide_run">            <span class="nam">qc_att</span> <span class="op">=</span> <span class="nam">dot_attention</span><span class="op">(</span><span class="nam">c</span><span class="op">,</span> <span class="nam">q</span><span class="op">,</span> <span class="nam">mask</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">q_mask</span><span class="op">,</span> <span class="nam">hidden</span><span class="op">=</span><span class="nam">d</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t97" class="stm run hide_run">            <span class="nam">rnn</span> <span class="op">=</span> <span class="nam">gru</span><span class="op">(</span><span class="nam">num_layers</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">num_units</span><span class="op">=</span><span class="nam">d</span><span class="op">,</span> <span class="nam">batch_size</span><span class="op">=</span><span class="nam">N</span><span class="op">,</span> <span class="nam">input_size</span><span class="op">=</span><span class="nam">qc_att</span><span class="op">.</span><span class="nam">get_shape</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">as_list</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t98" class="stm run hide_run">            <span class="nam">att</span> <span class="op">=</span> <span class="nam">rnn</span><span class="op">(</span><span class="nam">qc_att</span><span class="op">,</span> <span class="nam">seq_len</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">c_len</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t99" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t100" class="stm run hide_run">        <span class="key">with</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">variable_scope</span><span class="op">(</span><span class="str">'match'</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t101" class="stm run hide_run">            <span class="nam">self_att</span> <span class="op">=</span> <span class="nam">dot_attention</span><span class="op">(</span><span class="nam">att</span><span class="op">,</span> <span class="nam">att</span><span class="op">,</span> <span class="nam">mask</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">c_mask</span><span class="op">,</span> <span class="nam">hidden</span><span class="op">=</span><span class="nam">d</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t102" class="stm run hide_run">            <span class="nam">rnn</span> <span class="op">=</span> <span class="nam">gru</span><span class="op">(</span><span class="nam">num_layers</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">num_units</span><span class="op">=</span><span class="nam">d</span><span class="op">,</span> <span class="nam">batch_size</span><span class="op">=</span><span class="nam">N</span><span class="op">,</span> <span class="nam">input_size</span><span class="op">=</span><span class="nam">self_att</span><span class="op">.</span><span class="nam">get_shape</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">as_list</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t103" class="stm run hide_run">            <span class="nam">match</span> <span class="op">=</span> <span class="nam">rnn</span><span class="op">(</span><span class="nam">self_att</span><span class="op">,</span> <span class="nam">seq_len</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">c_len</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t104" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t105" class="stm run hide_run">        <span class="key">with</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">variable_scope</span><span class="op">(</span><span class="str">'pointer'</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t106" class="stm run hide_run">            <span class="nam">init</span> <span class="op">=</span> <span class="nam">summ</span><span class="op">(</span><span class="nam">q</span><span class="op">[</span><span class="op">:</span><span class="op">,</span> <span class="op">:</span><span class="op">,</span> <span class="op">-</span><span class="num">2</span> <span class="op">*</span> <span class="nam">d</span><span class="op">:</span><span class="op">]</span><span class="op">,</span> <span class="nam">d</span><span class="op">,</span> <span class="nam">mask</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">q_mask</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t107" class="stm run hide_run">            <span class="nam">pointer</span> <span class="op">=</span> <span class="nam">ptr_net</span><span class="op">(</span><span class="nam">batch</span><span class="op">=</span><span class="nam">N</span><span class="op">,</span> <span class="nam">hidden</span><span class="op">=</span><span class="nam">init</span><span class="op">.</span><span class="nam">get_shape</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">as_list</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t108" class="stm run hide_run">            <span class="nam">logits1</span><span class="op">,</span> <span class="nam">logits2</span> <span class="op">=</span> <span class="nam">pointer</span><span class="op">(</span><span class="nam">init</span><span class="op">,</span> <span class="nam">match</span><span class="op">,</span> <span class="nam">d</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">c_mask</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t109" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t110" class="stm run hide_run">        <span class="key">with</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">variable_scope</span><span class="op">(</span><span class="str">'predict'</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t111" class="stm run hide_run">            <span class="nam">outer</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">matmul</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">expand_dims</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">nn</span><span class="op">.</span><span class="nam">softmax</span><span class="op">(</span><span class="nam">logits1</span><span class="op">)</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">2</span><span class="op">)</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t112" class="pln">                              <span class="nam">tf</span><span class="op">.</span><span class="nam">expand_dims</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">nn</span><span class="op">.</span><span class="nam">softmax</span><span class="op">(</span><span class="nam">logits2</span><span class="op">)</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t113" class="stm run hide_run">            <span class="nam">outer</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">cond</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">tokens_in_context</span> <span class="op">&lt;</span> <span class="nam">self</span><span class="op">.</span><span class="nam">max_answer_tokens</span><span class="op">,</span> <span class="key">lambda</span><span class="op">:</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">matrix_band_part</span><span class="op">(</span><span class="nam">outer</span><span class="op">,</span> <span class="num">0</span><span class="op">,</span> <span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t114" class="pln">                <span class="key">lambda</span><span class="op">:</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">matrix_band_part</span><span class="op">(</span><span class="nam">outer</span><span class="op">,</span> <span class="num">0</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">max_answer_tokens</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t115" class="stm run hide_run">            <span class="nam">self</span><span class="op">.</span><span class="nam">yp1</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">reduce_max</span><span class="op">(</span><span class="nam">outer</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">2</span><span class="op">)</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t116" class="stm run hide_run">            <span class="nam">self</span><span class="op">.</span><span class="nam">yp2</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">tf</span><span class="op">.</span><span class="nam">reduce_max</span><span class="op">(</span><span class="nam">outer</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t117" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t118" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t119" class="stm run hide_run"><span class="key">class</span> <span class="nam">Inference</span><span class="op">(</span><span class="nam">object</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t120" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t121" class="stm run hide_run">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t122" class="stm run hide_run">        <span class="key">with</span> <span class="nam">open</span><span class="op">(</span><span class="nam">word_emb_file</span><span class="op">,</span> <span class="str">'r'</span><span class="op">)</span> <span class="key">as</span> <span class="nam">fh</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t123" class="stm run hide_run">            <span class="nam">self</span><span class="op">.</span><span class="nam">word_mat</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="nam">json</span><span class="op">.</span><span class="nam">load</span><span class="op">(</span><span class="nam">fh</span><span class="op">)</span><span class="op">,</span> <span class="nam">dtype</span><span class="op">=</span><span class="nam">np</span><span class="op">.</span><span class="nam">float32</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t124" class="stm run hide_run">        <span class="key">with</span> <span class="nam">open</span><span class="op">(</span><span class="nam">char_emb_file</span><span class="op">,</span> <span class="str">'r'</span><span class="op">)</span> <span class="key">as</span> <span class="nam">fh</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t125" class="stm run hide_run">            <span class="nam">self</span><span class="op">.</span><span class="nam">char_mat</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="nam">json</span><span class="op">.</span><span class="nam">load</span><span class="op">(</span><span class="nam">fh</span><span class="op">)</span><span class="op">,</span> <span class="nam">dtype</span><span class="op">=</span><span class="nam">np</span><span class="op">.</span><span class="nam">float32</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t126" class="stm run hide_run">        <span class="key">with</span> <span class="nam">open</span><span class="op">(</span><span class="nam">word2idx_file</span><span class="op">,</span> <span class="str">'r'</span><span class="op">)</span> <span class="key">as</span> <span class="nam">fh</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t127" class="stm run hide_run">            <span class="nam">self</span><span class="op">.</span><span class="nam">word2idx_dict</span> <span class="op">=</span> <span class="nam">json</span><span class="op">.</span><span class="nam">load</span><span class="op">(</span><span class="nam">fh</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t128" class="stm run hide_run">        <span class="key">with</span> <span class="nam">open</span><span class="op">(</span><span class="nam">char2idx_file</span><span class="op">,</span> <span class="str">'r'</span><span class="op">)</span> <span class="key">as</span> <span class="nam">fh</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t129" class="stm run hide_run">            <span class="nam">self</span><span class="op">.</span><span class="nam">char2idx_dict</span> <span class="op">=</span> <span class="nam">json</span><span class="op">.</span><span class="nam">load</span><span class="op">(</span><span class="nam">fh</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t130" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">model</span> <span class="op">=</span> <span class="nam">InfModel</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">word_mat</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">char_mat</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t131" class="stm run hide_run">        <span class="nam">sess_config</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">ConfigProto</span><span class="op">(</span><span class="nam">allow_soft_placement</span><span class="op">=</span><span class="key">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t132" class="stm run hide_run">        <span class="nam">sess_config</span><span class="op">.</span><span class="nam">gpu_options</span><span class="op">.</span><span class="nam">allow_growth</span> <span class="op">=</span> <span class="key">True</span><span class="strut">&nbsp;</span></p>
<p id="t133" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">sess</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">Session</span><span class="op">(</span><span class="nam">config</span><span class="op">=</span><span class="nam">sess_config</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t134" class="stm run hide_run">        <span class="nam">saver</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">train</span><span class="op">.</span><span class="nam">Saver</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t135" class="stm run hide_run">        <span class="nam">saver</span><span class="op">.</span><span class="nam">restore</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">sess</span><span class="op">,</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">train</span><span class="op">.</span><span class="nam">latest_checkpoint</span><span class="op">(</span><span class="nam">save_dir</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t136" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t137" class="stm run hide_run">    <span class="key">def</span> <span class="nam">response</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">context</span><span class="op">,</span> <span class="nam">question</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t138" class="stm run hide_run">        <span class="nam">sess</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">sess</span><span class="strut">&nbsp;</span></p>
<p id="t139" class="stm run hide_run">        <span class="nam">model</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">model</span><span class="strut">&nbsp;</span></p>
<p id="t140" class="stm run hide_run">        <span class="nam">span</span><span class="op">,</span> <span class="nam">context_idxs</span><span class="op">,</span> <span class="nam">ques_idxs</span><span class="op">,</span> <span class="nam">context_char_idxs</span><span class="op">,</span> <span class="nam">ques_char_idxs</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">prepro</span><span class="op">(</span><span class="nam">context</span><span class="op">,</span> <span class="nam">question</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t141" class="stm run hide_run">        <span class="nam">yp1</span><span class="op">,</span> <span class="nam">yp2</span> <span class="op">=</span> <span class="nam">sess</span><span class="op">.</span><span class="nam">run</span><span class="op">(</span><span class="op">[</span><span class="nam">model</span><span class="op">.</span><span class="nam">yp1</span><span class="op">,</span> <span class="nam">model</span><span class="op">.</span><span class="nam">yp2</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t142" class="pln">            <span class="nam">feed_dict</span><span class="op">=</span><span class="op">{</span><span class="nam">model</span><span class="op">.</span><span class="nam">c</span><span class="op">:</span> <span class="nam">context_idxs</span><span class="op">,</span> <span class="nam">model</span><span class="op">.</span><span class="nam">q</span><span class="op">:</span> <span class="nam">ques_idxs</span><span class="op">,</span> <span class="nam">model</span><span class="op">.</span><span class="nam">ch</span><span class="op">:</span> <span class="nam">context_char_idxs</span><span class="op">,</span> <span class="nam">model</span><span class="op">.</span><span class="nam">qh</span><span class="op">:</span> <span class="nam">ques_char_idxs</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t143" class="pln">                <span class="nam">model</span><span class="op">.</span><span class="nam">tokens_in_context</span><span class="op">:</span> <span class="nam">len</span><span class="op">(</span><span class="nam">span</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t144" class="stm run hide_run">        <span class="nam">start_idx</span> <span class="op">=</span> <span class="nam">span</span><span class="op">[</span><span class="nam">yp1</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t145" class="stm run hide_run">        <span class="nam">end_idx</span> <span class="op">=</span> <span class="nam">span</span><span class="op">[</span><span class="nam">yp2</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t146" class="stm run hide_run">        <span class="key">return</span> <span class="nam">context</span><span class="op">[</span><span class="nam">start_idx</span><span class="op">:</span> <span class="nam">end_idx</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t147" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t148" class="stm run hide_run">    <span class="key">def</span> <span class="nam">prepro</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">context</span><span class="op">,</span> <span class="nam">question</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t149" class="stm run hide_run">        <span class="nam">context</span> <span class="op">=</span> <span class="nam">context</span><span class="op">.</span><span class="nam">replace</span><span class="op">(</span><span class="str">"''"</span><span class="op">,</span> <span class="str">'" '</span><span class="op">)</span><span class="op">.</span><span class="nam">replace</span><span class="op">(</span><span class="str">'``'</span><span class="op">,</span> <span class="str">'" '</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t150" class="stm run hide_run">        <span class="nam">context_tokens</span> <span class="op">=</span> <span class="nam">word_tokenize</span><span class="op">(</span><span class="nam">context</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t151" class="stm run hide_run">        <span class="nam">context_chars</span> <span class="op">=</span> <span class="op">[</span><span class="nam">list</span><span class="op">(</span><span class="nam">token</span><span class="op">)</span> <span class="key">for</span> <span class="nam">token</span> <span class="key">in</span> <span class="nam">context_tokens</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t152" class="stm run hide_run">        <span class="nam">spans</span> <span class="op">=</span> <span class="nam">convert_idx</span><span class="op">(</span><span class="nam">context</span><span class="op">,</span> <span class="nam">context_tokens</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t153" class="stm run hide_run">        <span class="nam">ques</span> <span class="op">=</span> <span class="nam">question</span><span class="op">.</span><span class="nam">replace</span><span class="op">(</span><span class="str">"''"</span><span class="op">,</span> <span class="str">'" '</span><span class="op">)</span><span class="op">.</span><span class="nam">replace</span><span class="op">(</span><span class="str">'``'</span><span class="op">,</span> <span class="str">'" '</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t154" class="stm run hide_run">        <span class="nam">ques_tokens</span> <span class="op">=</span> <span class="nam">word_tokenize</span><span class="op">(</span><span class="nam">ques</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t155" class="stm run hide_run">        <span class="nam">ques_chars</span> <span class="op">=</span> <span class="op">[</span><span class="nam">list</span><span class="op">(</span><span class="nam">token</span><span class="op">)</span> <span class="key">for</span> <span class="nam">token</span> <span class="key">in</span> <span class="nam">ques_tokens</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t156" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t157" class="stm run hide_run">        <span class="nam">context_idxs</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">[</span><span class="num">1</span><span class="op">,</span> <span class="nam">len</span><span class="op">(</span><span class="nam">context_tokens</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">dtype</span><span class="op">=</span><span class="nam">np</span><span class="op">.</span><span class="nam">int32</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t158" class="stm run hide_run">        <span class="nam">context_char_idxs</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">[</span><span class="num">1</span><span class="op">,</span> <span class="nam">len</span><span class="op">(</span><span class="nam">context_tokens</span><span class="op">)</span><span class="op">,</span> <span class="nam">char_limit</span><span class="op">]</span><span class="op">,</span> <span class="nam">dtype</span><span class="op">=</span><span class="nam">np</span><span class="op">.</span><span class="nam">int32</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t159" class="stm run hide_run">        <span class="nam">ques_idxs</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">[</span><span class="num">1</span><span class="op">,</span> <span class="nam">len</span><span class="op">(</span><span class="nam">ques_tokens</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">dtype</span><span class="op">=</span><span class="nam">np</span><span class="op">.</span><span class="nam">int32</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t160" class="stm run hide_run">        <span class="nam">ques_char_idxs</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">[</span><span class="num">1</span><span class="op">,</span> <span class="nam">len</span><span class="op">(</span><span class="nam">ques_tokens</span><span class="op">)</span><span class="op">,</span> <span class="nam">char_limit</span><span class="op">]</span><span class="op">,</span> <span class="nam">dtype</span><span class="op">=</span><span class="nam">np</span><span class="op">.</span><span class="nam">int32</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t161" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t162" class="stm run hide_run">        <span class="key">def</span> <span class="nam">_get_word</span><span class="op">(</span><span class="nam">word</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t163" class="stm run hide_run">            <span class="key">for</span> <span class="nam">each</span> <span class="key">in</span> <span class="op">(</span><span class="nam">word</span><span class="op">,</span> <span class="nam">word</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span><span class="op">,</span> <span class="nam">word</span><span class="op">.</span><span class="nam">capitalize</span><span class="op">(</span><span class="op">)</span><span class="op">,</span> <span class="nam">word</span><span class="op">.</span><span class="nam">upper</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t164" class="stm run hide_run">                <span class="key">if</span> <span class="nam">each</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">word2idx_dict</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t165" class="stm run hide_run">                    <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">word2idx_dict</span><span class="op">[</span><span class="nam">each</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t166" class="stm run hide_run">            <span class="key">return</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t167" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t168" class="stm run hide_run">        <span class="key">def</span> <span class="nam">_get_char</span><span class="op">(</span><span class="nam">char</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t169" class="stm run hide_run">            <span class="key">if</span> <span class="nam">char</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">char2idx_dict</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t170" class="stm run hide_run">                <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">char2idx_dict</span><span class="op">[</span><span class="nam">char</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t171" class="stm mis">            <span class="key">return</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t172" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t173" class="stm run hide_run">        <span class="key">for</span> <span class="nam">i</span><span class="op">,</span> <span class="nam">token</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">context_tokens</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t174" class="stm run hide_run">            <span class="nam">context_idxs</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="nam">i</span><span class="op">]</span> <span class="op">=</span> <span class="nam">_get_word</span><span class="op">(</span><span class="nam">token</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t175" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t176" class="stm run hide_run">        <span class="key">for</span> <span class="nam">i</span><span class="op">,</span> <span class="nam">token</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">ques_tokens</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t177" class="stm run hide_run">            <span class="nam">ques_idxs</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="nam">i</span><span class="op">]</span> <span class="op">=</span> <span class="nam">_get_word</span><span class="op">(</span><span class="nam">token</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t178" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t179" class="stm run hide_run">        <span class="key">for</span> <span class="nam">i</span><span class="op">,</span> <span class="nam">token</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">context_chars</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t180" class="stm run hide_run">            <span class="key">for</span> <span class="nam">j</span><span class="op">,</span> <span class="nam">char</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">token</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t181" class="stm run hide_run">                <span class="key">if</span> <span class="nam">j</span> <span class="op">==</span> <span class="nam">char_limit</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t182" class="stm run hide_run">                    <span class="key">break</span><span class="strut">&nbsp;</span></p>
<p id="t183" class="stm run hide_run">                <span class="nam">context_char_idxs</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="nam">i</span><span class="op">,</span> <span class="nam">j</span><span class="op">]</span> <span class="op">=</span> <span class="nam">_get_char</span><span class="op">(</span><span class="nam">char</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t184" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t185" class="stm run hide_run">        <span class="key">for</span> <span class="nam">i</span><span class="op">,</span> <span class="nam">token</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">ques_chars</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t186" class="stm run hide_run">            <span class="key">for</span> <span class="nam">j</span><span class="op">,</span> <span class="nam">char</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">token</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t187" class="stm run hide_run">                <span class="key">if</span> <span class="nam">j</span> <span class="op">==</span> <span class="nam">char_limit</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t188" class="stm mis">                    <span class="key">break</span><span class="strut">&nbsp;</span></p>
<p id="t189" class="stm run hide_run">                <span class="nam">ques_char_idxs</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="nam">i</span><span class="op">,</span> <span class="nam">j</span><span class="op">]</span> <span class="op">=</span> <span class="nam">_get_char</span><span class="op">(</span><span class="nam">char</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t190" class="stm run hide_run">        <span class="key">return</span> <span class="nam">spans</span><span class="op">,</span> <span class="nam">context_idxs</span><span class="op">,</span> <span class="nam">ques_idxs</span><span class="op">,</span> <span class="nam">context_char_idxs</span><span class="op">,</span> <span class="nam">ques_char_idxs</span><span class="strut">&nbsp;</span></p>
<p id="t191" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t192" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t193" class="pln"><span class="com"># Demo, example from paper "SQuAD: 100,000+ Questions for Machine Comprehension of Text"</span><span class="strut">&nbsp;</span></p>
<p id="t194" class="stm run hide_run"><span class="nam">flags</span> <span class="op">=</span> <span class="nam">tf</span><span class="op">.</span><span class="nam">flags</span><span class="strut">&nbsp;</span></p>
<p id="t195" class="stm run hide_run"><span class="nam">flags</span><span class="op">.</span><span class="nam">DEFINE_string</span><span class="op">(</span><span class="str">'context'</span><span class="op">,</span> <span class="str">'The New York City, the City That Never Sleeps&#8212;New York is a city of superlatives: Americas biggest; its most exciting; its business and cultural capitals; the nations trendsetter. The city seems to pull in the best and the brightest from every corner of the country. The citys ethnic flavor has been nuanced by decades of immigrants whose first glimpse of America was the Statue of Liberty guarding New York Harbor and by large expatriate communities such as the United Nations headquartered there. Just minutes from the multimillion-dollar two-bedroom co-op apartments of Park Avenue, though, lies some of the most dire urban poverty in America. But the attendant crime that affects New Yorkers and visitors alike has seen a continued dramatic reduction from 1993 to 2004&#8212;NYC has a murder rate half that of cities such as Los Angeles and Chicago, in part as the result of a concerted effort by local agencies. But for all its eight million residents, New York remains a city of neighborhoods, whether its avant-garde Greenwich Village, bustling Harlem, the ultra-sophisticated TriBeCa, or one of the ethnic enclaves such as Little Italy or Chinatown. And a cleaner, brighter, safer New York is attracting people from around the world who are coming to enjoy the citys renaissance.'</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t196" class="pln">                    <span class="str">'article content'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t197" class="stm run hide_run"><span class="nam">flags</span><span class="op">.</span><span class="nam">DEFINE_list</span><span class="op">(</span><span class="str">'question_list'</span><span class="op">,</span> <span class="op">[</span><span class="str">'where is New York City'</span><span class="op">]</span><span class="op">,</span> <span class="str">'question list'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t198" class="stm run hide_run"><span class="nam">flags</span><span class="op">.</span><span class="nam">DEFINE_string</span><span class="op">(</span><span class="str">'context_path'</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'article context path'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t199" class="stm run hide_run"><span class="nam">flags</span><span class="op">.</span><span class="nam">DEFINE_string</span><span class="op">(</span><span class="str">'questions_path'</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'questions path'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t200" class="stm run hide_run"><span class="nam">flags</span><span class="op">.</span><span class="nam">DEFINE_string</span><span class="op">(</span><span class="str">'inference_mode'</span><span class="op">,</span> <span class="str">'default'</span><span class="op">,</span> <span class="str">'test user designated file or default files'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t201" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t202" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t203" class="stm run hide_run"><span class="key">def</span> <span class="nam">infer</span><span class="op">(</span><span class="nam">inference</span><span class="op">,</span> <span class="nam">context_file</span><span class="op">,</span> <span class="nam">questions_file</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t204" class="stm run hide_run">    <span class="key">assert</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">isfile</span><span class="op">(</span><span class="nam">context_file</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t205" class="stm run hide_run">    <span class="key">assert</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">isfile</span><span class="op">(</span><span class="nam">questions_file</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t206" class="stm run hide_run">    <span class="key">with</span> <span class="nam">open</span><span class="op">(</span><span class="nam">context_file</span><span class="op">,</span> <span class="str">'r'</span><span class="op">)</span> <span class="key">as</span> <span class="nam">f</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t207" class="stm run hide_run">        <span class="nam">context</span> <span class="op">=</span> <span class="nam">f</span><span class="op">.</span><span class="nam">readline</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t208" class="stm run hide_run">    <span class="nam">print</span><span class="op">(</span><span class="str">'================================='</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t209" class="stm run hide_run">    <span class="nam">print</span><span class="op">(</span><span class="str">'This is context from'</span><span class="op">,</span> <span class="nam">context_file</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t210" class="stm run hide_run">    <span class="key">with</span> <span class="nam">open</span><span class="op">(</span><span class="nam">questions_file</span><span class="op">,</span> <span class="str">'r'</span><span class="op">)</span> <span class="key">as</span> <span class="nam">f</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t211" class="stm run hide_run">        <span class="key">for</span> <span class="nam">question</span> <span class="key">in</span> <span class="nam">f</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t212" class="stm run hide_run">            <span class="key">if</span> <span class="key">not</span> <span class="nam">question</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t213" class="stm mis">                <span class="key">continue</span><span class="strut">&nbsp;</span></p>
<p id="t214" class="stm run hide_run">            <span class="nam">print</span><span class="op">(</span><span class="str">'Question:'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t215" class="stm run hide_run">            <span class="nam">print</span><span class="op">(</span><span class="nam">question</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t216" class="stm run hide_run">            <span class="nam">print</span><span class="op">(</span><span class="str">'Answer:'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t217" class="stm run hide_run">            <span class="nam">answer</span> <span class="op">=</span> <span class="nam">inference</span><span class="op">.</span><span class="nam">response</span><span class="op">(</span><span class="nam">context</span><span class="op">,</span> <span class="nam">question</span><span class="op">)</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t218" class="stm run hide_run">            <span class="nam">print</span><span class="op">(</span><span class="nam">answer</span><span class="op">,</span> <span class="str">'\n'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t219" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t220" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t221" class="stm run hide_run"><span class="key">def</span> <span class="nam">main</span><span class="op">(</span><span class="nam">_</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t222" class="stm run hide_run">    <span class="nam">config</span> <span class="op">=</span> <span class="nam">flags</span><span class="op">.</span><span class="nam">FLAGS</span><span class="strut">&nbsp;</span></p>
<p id="t223" class="stm run hide_run">    <span class="nam">print</span><span class="op">(</span><span class="str">'Beginning of testing of r_net model'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t224" class="stm run hide_run">    <span class="nam">print</span><span class="op">(</span><span class="str">'Mode:'</span><span class="op">,</span> <span class="nam">config</span><span class="op">.</span><span class="nam">inference_mode</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t225" class="stm run hide_run">    <span class="key">if</span> <span class="nam">config</span><span class="op">.</span><span class="nam">inference_mode</span> <span class="op">==</span> <span class="str">'default'</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t226" class="stm run hide_run">        <span class="nam">inference</span> <span class="op">=</span> <span class="nam">Inference</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t227" class="stm run hide_run">        <span class="key">for</span> <span class="nam">idx</span> <span class="key">in</span> <span class="nam">os</span><span class="op">.</span><span class="nam">listdir</span><span class="op">(</span><span class="str">'{}/testcases/contexts'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">home_dir</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t228" class="stm run hide_run">            <span class="key">if</span> <span class="key">not</span> <span class="nam">idx</span><span class="op">.</span><span class="nam">isdigit</span><span class="op">(</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t229" class="stm mis">                <span class="key">continue</span><span class="strut">&nbsp;</span></p>
<p id="t230" class="stm run hide_run">            <span class="nam">infer</span><span class="op">(</span><span class="nam">inference</span><span class="op">,</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="str">'{}/testcases'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">home_dir</span><span class="op">)</span><span class="op">,</span> <span class="str">'contexts'</span><span class="op">,</span> <span class="nam">idx</span><span class="op">)</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t231" class="pln">                  <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="str">'{}/testcases'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">home_dir</span><span class="op">)</span><span class="op">,</span> <span class="str">'questions'</span><span class="op">,</span> <span class="nam">idx</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t232" class="stm run hide_run">    <span class="key">elif</span> <span class="nam">config</span><span class="op">.</span><span class="nam">inference_mode</span> <span class="op">==</span> <span class="str">'customized'</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t233" class="stm run hide_run">        <span class="nam">inference</span> <span class="op">=</span> <span class="nam">Inference</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t234" class="stm run hide_run">        <span class="nam">infer</span><span class="op">(</span><span class="nam">inference</span><span class="op">,</span> <span class="nam">config</span><span class="op">.</span><span class="nam">context_path</span><span class="op">,</span> <span class="nam">config</span><span class="op">.</span><span class="nam">questions_path</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t235" class="pln">    <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t236" class="stm mis">        <span class="key">raise</span> <span class="nam">ValueError</span><span class="op">(</span><span class="str">'unknown inference mode'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t237" class="stm run hide_run">    <span class="nam">print</span><span class="op">(</span><span class="str">'End of testing of r_net model'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t238" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t239" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t240" class="stm run hide_run"><span class="key">if</span> <span class="nam">__name__</span> <span class="op">==</span> <span class="str">'__main__'</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t241" class="stm run hide_run">    <span class="nam">tf</span><span class="op">.</span><span class="nam">app</span><span class="op">.</span><span class="nam">run</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t242" class="pln">    <span class="com"># 123</span><span class="strut">&nbsp;</span></p>

            </td>
        </tr>
    </table>
</div>

<div id="footer">
    <div class="content">
        <p>
            <a class="nav" href="index.html">&#xab; index</a> &nbsp; &nbsp; <a class="nav" href="https://coverage.readthedocs.io">coverage.py v4.5.2</a>,
            created at 2018-12-14 15:28
        </p>
    </div>
</div>

</body>
</html>
